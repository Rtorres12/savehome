<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Productos</title>
   <link rel="stylesheet" href="/css/tiny-slider.css">
   
   
          <%- include ('partials/head.html')%>
          <style> html,body{
            overflow-x: hidden !important;
          }
      
          </style>
      
          
</head>
<body >

    <%- include ('partials/nav.html')%>
    
  
  </div>
      <div id="carouselExampleIndicators"  class="ml-2 mt-3 mr-2 carousel slide shadow " data-ride="carousel">
          <ol class="carousel-indicators">
              <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
              <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
              <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
          </ol>
          <div class="carousel-inner  ">
  
              <div class="carousel-item active" data-interval="3000">
  

                  <img src="/img/car_1.jpg" style="max-height: 450px;" alt="" class="d-block w-100" alt="...">
  
              </div>  
              <div class="carousel-item" data-interval="3000">
                  <img src="/img/car_2.jpg" style="max-height: 450px;" class="d-block w-100" alt="...">
              </div>
              <div class="carousel-item" data-interval="3000">
                  <img src="/img/car_3.jpg" style="max-height: 450px;" class="d-block w-100" alt="...">
              </div>
              
           
       
            
        
  
          </div>
          <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
          </a>
      </div>
  </div>
  
  


  



<br>
<%if(typeof datacat !=='undefined'){%>
  <input class="bg-primary" type="hidden" id="cat" value="<%=datacat%>">
  <%}%>
  <%if(typeof datasubcat !=='undefined'){%>
    <input class="bg-primary" type="hidden" id="subcat" value="<%=datasubcat%>">
    <%}%>
    <center>
    <div class="shadow"  style="background:linear-gradient(90deg,#4276FA, #1b437e)">
        <br>
    <div class="col-md-2 mb-4">
        <h6 class="medium-font " style="color: white;">RECOMENDACIONES</h6>
        <hr class="bg-primary mb-4 mt-0 d-inline-block mx-auto" style="width: 350px; height: 2px">
        <a href="#"></a>
      </div>
      </center>
    <div class="ml-5 mr-5">
      <div class="my-slider" >
        
        <%for (var i=0; i < data.length; i++){%>

          <%if(data[i].recomendado == "on"){%>
        <div>
          <div>
            <div class=" mb-2 shadow card ml-3 card-hover " category="<%=data[i].categoria%>" subcategory="<%=data[i].id_subcat%>" style="width: 13rem; height: 25rem;">
              <%if(data[i].descuento !==0){%>
                <span class="position-absolute px-4 py-1 text-white oferta font-weight-bold" style="background-color: #4276FA;" >-<%=data[i].descuento%>%</span>
                <%}%>
            <img src="/prodImg/<%=data[i].prodImg%>" class="img-fluid card-img-top card-img-bottom " alt="...">
           
            <div class="card-body ">

              <h5 class="card-title text-right" style="height: 2rem"><%=data[i].nom_producto%></h5>
            
              <div class="row" >
                <div class="col " >
                  <%if(data[i].descuento !==0){%>
                <p class="text-truncate text-right" style="text-decoration: line-through;">S/ <%=data[i].precio%></p>
                <%}%>
  
              </div>
              <div class="col" >
               
                <p class="text-truncate text-left font-weight-bold" >S/<%=data[i].precioNeto%></p>
              </div>
              </div> 
              <div class="row">
                <a href="#" data-toggle="modal" data-target="#modalProd<%=data[i].id_prod%>" class="  text-truncate btn-block btn btn-primary">Ver ;)</a>
  
              </div>
            </div>
           

          </div>
        </div>
        </div>
        <%}%>
   <%}%>
      </div>
    </div>
   <!--   -->


<div  id="scroll-prod"  style="background:linear-gradient(90deg, #1b437e,#4276FA)">
  <br>
  <CENTER>
    <div class="col-md-2 mb-4">
  <h6 class="medium-font " style="color: white;">PRODUCTOS</h6>
  <hr class="bg-primary mb-4 mt-0 d-inline-block mx-auto" style="width: 210px; height: 2px">
  <a href="#"></a>
</div>
</div>
</CENTER>
<br>
<div class=" row ">
  <div class="category_list col-md-2 ml-3 mt-3 justify-content-center" >
    <a class="btn  btn-block  category_item bg-primary " subcategory="Todo" >Todo </a>
    
    <div class="accordion" id="accordionExample">
      <%for (var j=0 ; j < data1.length ; j ++ ){%>


        <div class="card-header" id="headingOne">
          <h2 class="mb-0">

            <button class="btn  btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseOne<%=data1[j].id_cat%>" aria-expanded="true" aria-controls="collapseOne">
              
              <%=data1[j].categoria%> <i class="fas fa-caret-down"></i>
            </button>
          </h2>
        </div>
    
        <div id="collapseOne<%=data1[j].id_cat%>" class=" collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
          <div class="card-body">
            <%for (var k=0 ; k < data2.length ; k ++ ){
              if (data2[k].id_cat == data1[j].id_cat){
              %>

              <a class="btn btn-block text-left category_item " subcategory="<%=data2[k].id %>"><%=data2[k].subcategoria%></a>
              <%}}%> 
          </div>
        </div>

      <%}%>

    </div>
   
  <!--   <%for (var j=0 ; j < data1.length ; j ++ ){%>

    <a class="btn btn-block btn-warning category_item"  category="<%=data1[j].categoria %>" ><%=data1[j].categoria%></a>
<%}%> -->
  </div>
  <div class="col mt-3 " >
    <div class="products-list row d-flex justify-content-center">
      <%for (var i=0 ; i < data.length ; i ++ ){%>

        <div class="modal fade  " id="modalProd<%=data[i].id_prod%>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"><%=data[i].nom_producto%></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" style="background-image: url('/img/fondo1.svg');background-position: center center;
              ">

                <div class="row">
                  <div class="col-md-6 ">
                    <div id="carouselExampleInterval<%=data[i].id_prod%>" class="carousel slide d-flex añ" data-ride="carousel">
                      <div class="carousel-inner">
                        <% if(data[i].prodImg){%>
                        <div class="carousel-item active" data-interval="10000">
                         
                          <img src="/prodImg/<%=data[i].prodImg%>" class="d-block w-100" alt="...">
                        </div>
                        <%}%>
                        <% 
                      
                        if(data[i].prodImg2 !== "null"){%>

                        <div class="carousel-item" data-interval="2000">
                          <img src="/prodImg/<%=data[i].prodImg2%>" class="d-block w-100" alt="...">

                        </div>
                        <%}%>
                        <%

                        if(data[i].prodimg3 !== 'null'){%>

                        <div class="carousel-item">
                          <img src="/prodImg/<%=data[i].prodImg3%>" class="d-block w-100" alt="...">
                        </div>
                        <%}%>
                      </div>
                      <a class="carousel-control-prev" href="#carouselExampleInterval<%=data[i].id_prod%>" role="button" data-slide="prev">
                        <i  style="color: #4276FA; font-size: 3rem;" class="fas fa-chevron-left" aria-hidden="true"></i>                        <span class="sr-only">Previous</span>
                      </a>
                      <a class="carousel-control-next" href="#carouselExampleInterval<%=data[i].id_prod%>" role="button" data-slide="next">
                        <i style="color:  #4276FA; font-size: 3rem;" class="fas fa-chevron-right" aria-hidden="true"></i>                        <span class="sr-only">Previous</span>
                        <span class="sr-only">Next</span>
                      </a>
                    </div>

                  </div>
                  <div class="col-md-6  " >
                    
                    <h1 class="display-4 text-right" ><%=data[i].nom_producto%>  </h1>

                  <div class="caract"  style="height: 16rem; overflow: scroll;" >                   
                  
                  
                    <%-data[i].caracteristicas%>
               
                
                  </div>
                  
               

                  </div>

                  <div class="col-md-12 d-flex justify-content-end">
                    <%if(data[i].descuento !==0){%>
                      <h4 class="display-4 text-break text-right " style="text-decoration: line-through;">S/ <%=data[i].precio%></h4>
                     <%}%> 
                      <h4 class="display-4 text-break text-right ">S/ <%=data[i].precioNeto%></h4>
                   
                     </div>

                </div>


              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <a target="_blank"  data-id-prod="<%=data[i].id_prod%>" class="btn btn-primary insertCarrito">agregar</a>
              </div>
            </div>
          </div>
        </div>



        <div class=" product-item mb-2 shadow  card card-hover ml-3 " category="<%=data[i].id_cat %>" subcategory="<%=data[i].id_subcat%>" style="width: 12rem; ">
          <%if(data[i].descuento !==0){%>
          <span class="position-absolute px-4 py-1 text-white oferta font-weight-bold" style="background-color: #4276FA;" >-<%=data[i].descuento%>%</span>
          <%}%>
          <img src="/prodImg/<%=data[i].prodImg%>" class="img-fluid card-img-top card-img-bottom " alt="...">
         
          <div class="card-body" >
            
            <h5 class="card-title text-right" ><%=data[i].nom_producto%></h5>
            <div class="row">
              <div class="col">
                <%if(data[i].descuento !==0){%>
              <p class="text-truncate text-sm-right" style="text-decoration: line-through;">S/ <%=data[i].precio%></p>
              <%}%>

            </div>
            <div class="col">
             
              <p class="text-truncate text-sm-left font-weight-bold" >S/<%=data[i].precioNeto%></p>
            </div>
            </div>
              <div class="row">
            <a href="#" data-toggle="modal" data-target="#modalProd<%=data[i].id_prod%>" class=" text-truncate btn-block btn btn-primary">Ver ;)</a>
          </div>
          </div>


        </div>
        
        <%}%>
        </div>
      </div>
      
      </div>



  




<%- include ('partials/footer.html')%>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script><script src ="https://cdn.jsdelivr.net/npm/@glidejs/glide"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/scrollReveal.js/0.1.1/scrollReveal.min.js" integrity="sha512-FDQlM/I5n8d3aaXq+RCosJqohfgGdhzGeOR2SFdiN0nSfEp6MD+L1WvRGduPVu3DPO1yjDav7ICmoa3wJyVlxg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tiny-slider/2.9.2/min/tiny-slider.js"></script>
<script src="/js/filtrar.js"></script>
<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll@15.0.0/dist/smooth-scroll.polyfills.min.js"></script>
<script src="/js/jquery.richtext.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<%if (datascroll=='on' ){%>
  <script>
  
  var scroll = new SmoothScroll();
  
  scroll.animateScroll(1200);
  
   </script>
  <%}%>
          <script>
          let slider = tns({
    container: '.my-slider',
    slideBy: '1',
    autoplay: true,
    nav : false,
    autoplay: true,
    autoplayButtonOutput:false,
      mouseDrag: true,
    autoWidth: true,
    loop:true,
    speed:500,
    controlsPosition:'bottom',
    controlsText: ["<i style='font-size:3vw'  class='fas fa-long-arrow-alt-left'></i>","<i  style='font-size:3vw' class='fas fa-long-arrow-alt-right'></i>"]
  });
        window.sr=ScrollReveal();
  
        
  
        sr.reveal('.header-content-left',{
          duration: 2000,
          origin: 'left',
          distance: '200px'
        });
        sr.reveal('.header-content-right',{
          duration: 2000,
          origin: 'left',
          distance: '200px'
        });
        sr.reveal('.info-left',{
          duration: 2000,
          origin: 'left',
          distance: '200px'
        });
  
        sr.reveal('.info-right',{
          duration: 2000,
          origin: 'left',
          distance: '200px'
        });
  
      
      
      </script>
    <script>
      $(document).ready(function () {
          // Agrega un controlador de eventos a la clase insertCarrito
            $(document).on('click', '.insertCarrito', function() {

              event.preventDefault();  // Previene la acción predeterminada del enlace
  
              // Obtén el id_prod del atributo data-id-prod
              var id_prod = $(this).data('id-prod');
  
              // Obtén el id_person desde el campo data-id-person en el mismo contenedor
              var userDataForSession = localStorage.getItem('userDataForSession');

                var userData = JSON.parse(userDataForSession);
                var id_person = userData[0][0].IdPerson;
            // Lógica para obtener los datos necesario  
              // Realiza la petición POST con AJAX
              $.ajax({
                  type: 'POST',
                  url: '/insertCarrito',  // Reemplaza con la ruta correcta de tu servidor
                  data: {
                      id_prod: id_prod,
                      id_person: id_person
                      // Agrega más datos si es necesario
                  },
                  success: function (response) {
                      // Lógica para manejar la respuesta exitosa
                      Swal.fire({
                        icon: 'success',
                        title: '¡Producto agregado a sus pedidos!',
                        showConfirmButton: true,
                        timer: 1500
                      })
                  },
                  error: function (error) {
                      // Lógica para manejar errores
                      console.error('Error en la petición AJAX:', error);
                  }
              });
          });
      });
  </script>
      <script>

            
        window.onload = function(){
      
      // Recuperar la información de sesión del localStorage
      var userDataForSession = localStorage.getItem('userDataForSession');
      
      // Obtener el elemento donde se mostrará la información de sesión
      var sessionInfoElement = document.getElementById('sessionInfo');
      
      // Verificar si hay información de sesión
      if (userDataForSession) {
      // La sesión existe, muestra la información de sesión
      var userData = JSON.parse(userDataForSession);
      console.log(userData)
      sessionInfoElement.innerHTML = '  <a class="nav-link text-dark" type="button" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="fas text-light fa-user"></i> '+userData[0][0].FullName+' </a> <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"><a class="dropdown-item" href="/carrito">Mis pedidos</a> <a class="dropdown-item" id="cerrarSesionBtn" href="#">Cerrar sesion</div>';
      } else {
      // No hay sesión, muestra el enlace "Log In"
      sessionInfoElement.innerHTML = ' <a class="nav-link text-dark" href="/login"><i class="fas text-light fa-user"></i> Log In</a>';
      }
      }
      
      $(document).on('click', '#cerrarSesionBtn', function() {
    cerrarSesion();
});

        // ...

        // Función para cerrar la sesión
        function cerrarSesion() {
            // Limpiar la información de sesión en el localStorage
            localStorage.removeItem('userDataForSession');
            // Redirige a la página de inicio después de cerrar sesión
            window.location.href = '/';
        }
      </script>
  </body>

</html>

</body>
</html>